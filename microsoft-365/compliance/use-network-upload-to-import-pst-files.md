---
title: ネットワーク アップロードを使用して PST ファイルをインポートする
f1.keywords:
- NOCSH
ms.author: v-tophillips
author: v-tophillips
manager: laurawi
audience: Admin
ms.topic: article
ms.service: O365-seccomp
ms.localizationpriority: high
ms.collection:
- Strat_O365_IP
- M365-security-compliance
search.appverid:
- MOE150
- MED150
- MET150
ms.assetid: 103f940c-0468-4e1a-b527-cc8ad13a5ea6
description: '管理者向け: ネットワーク アップロードを使用して、複数の PST ファイルを Microsoft 365 のユーザー メールボックスに一括インポートする方法について説明します。'
ms.custom: seo-marvel-apr2020
ms.openlocfilehash: 3584397f7d01ea77ad03099aadeb085b497c53f3
ms.sourcegitcommit: 10e6abe740e27000e223378eb17d657a47555fa8
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/31/2022
ms.locfileid: "67470233"
---
# <a name="use-network-upload-to-import-your-organizations-pst-files-to-microsoft-365"></a>ネットワーク アップロードを使用して、組織の PST ファイルを Microsoft 365 にインポートする

>*[セキュリティとコンプライアンスのための Microsoft 365 ライセンス ガイダンス](/office365/servicedescriptions/microsoft-365-service-descriptions/microsoft-365-tenantlevel-services-licensing-guidance/microsoft-365-security-compliance-licensing-guidance)。*

> [!NOTE]
> この記事は管理者向けです。自分のメールボックスに PST ファイルをインポートする場合は、「[Outlook .pst ファイルからメール、連絡先、予定表をインポートする](https://go.microsoft.com/fwlink/p/?LinkID=785075)」を参照してください。
  
ネットワーク アップロードを使用して、複数の PST ファイルを Microsoft 365 のメールボックスに一括インポートするために必要なステップ バイ ステップによる手順を以下に示します。 ネットワーク アップロードを使用した Microsoft 365 メールボックスへの PST ファイルの一括インポートについてよく寄せられる質問については、「[ネットワーク アップロードを使用して PST ファイルをインポートすることについてよく寄せられる質問](./faqimporting-pst-files-to-office-365.yml#using-network-upload-to-import-pst-files)」を参照してください。
  
[手順 1: SAS URL をコピーして AzCopy をダウンロードする](#step-1-copy-the-sas-url-and-download-azcopy)

[手順 2: Microsoft 365 に PST ファイルをアップロードする](#step-2-upload-your-pst-files-to-microsoft-365)

[(省略可能) 手順 3: アップロードされた PST ファイルのリストを表示する](#optional-step-3-view-a-list-of-the-pst-files-uploaded-to-microsoft-365)

[手順 4: PST インポート マッピング ファイルを作成する](#step-4-create-the-pst-import-mapping-file)

[手順 5: PST インポート ジョブを作成する](#step-5-create-a-pst-import-job)

[手順 6: データをフィルター処理して、PST インポート ジョブを開始する](#step-6-filter-data-and-start-the-pst-import-job)

PST ファイルを Microsoft 365 メールボックスにインポートするには、1 回だけ手順 1 を行う必要があります。これらの手順を実行した後、 PST ファイルのバッチのアップロードとインポートを行うたびに、手順 2 から手順 6 を実行します。

## <a name="before-you-import-pst-files"></a>PST ファイルをインポートする前に
  
- Microsoft Purview コンプライアンス ポータルでインポート ジョブを作成し、ユーザー メールボックスに PST ファイルをインポートするには、Exchange Online で Mailbox Import Export 役割が割り当てられている必要があります。既定では、Exchange Online では、この役割はいずれの役割グループにも割り当てられていません。Mailbox Import Export 役割は Organization Management 役割グループに追加できます。または、役割グループを作成し、Mailbox Import Export 役割を割り当て、自分をメンバーとして追加できます。詳細については、「[役割グループの管理](/Exchange/permissions-exo/role-groups)」の「役割グループに役割を追加する」または「役割グループを作成する」のセクションを参照してください。

    メールボックスのインポートとエクスポートの役割に加えて、Exchange Online でメールの受信者の役割も割り当てる必要があります。 既定では、この役割は Exchange Online の Organization Management 役割グループと Recipient Management 役割グループに割り当てられます。

    > [!TIP]
    > PST ファイルをインポートするための新しい役割グループを ExchangeOnline で作成することを検討します。PST ファイルをインポートするのに必要な最小レベルの権限では、新しい役割グループに Mailbox Import Export の役割および Mail Recipients の役割を割り当て、メンバーを追加します。
  
- PST ファイルを Microsoft 365 にインポートするためにサポートされている唯一の方法は、この記事で説明されているように、AzCopy ツールを使用することです。 Azure Storage Explorer を使用して、PST ファイルを Azure Storage 領域に直接アップロードすることができません。

- PST ファイルが大きい場合、PST のインポート プロセスのパフォーマンスに影響を与える場合があります。 そのため、手順 2で Azure Storage の場所にアップロードするそれぞれの PST ファイルは、20 GB 以下にすることをお勧めします。

- この手順では、アクセス キーを含む URL をコピーして保存します。 この情報は、PST ファイルをアップロードするために手順 2 で、Microsoft 365 にアップロードされた PST ファイルのリストを表示する場合に手順 3 で使用されます。 パスワードや他のセキュリティ関連の情報を保護するのと同じように、この URL を保護する予防措置を講じる必要があります。 たとえば、この URL をパスワードで保護された Microsoft Word ドキュメントに保存したり、暗号化された USB ドライブに保存したりします。 この URL とキーの組み合わせの例については、「[詳細情報](#more-information)」セクションを参照してください。

- PST ファイルを Microsoft 365 の非アクティブなメールボックスにインポートできます。 PST インポート マッピング ファイルの `Mailbox` パラメーターで非アクティブなメールボックスの GUID を指定して、この操作を行います。 詳細については、この記事の「**手順**」タブの手順 4 を参照してください。

- Exchange ハイブリッド展開では、オンプレミスのプライマリ メールボックスを持つユーザーのために、PST ファイルをクラウド ベースのアーカイブ メールボックスにインポートすることができます。 PST インポート マッピング ファイルに次を指定して、この操作を行います。

  - `Mailbox` パラメーターに、ユーザーのオンプレミス メールボックス用のメール アドレスを指定します。

  - `IsArchive` パラメーターに、**TRUE** 値を指定します。

    詳細については、[手順 4](#step-4-create-the-pst-import-mapping-file) を参照してください。

- PST ファイルがインポートされると、メールボックスのアイテム保持ホールド設定が無期限でオンになります。 つまり、メールボックスに割り当てられたアイテム保持ポリシーは、アイテム保持ホールドをオフにするか、またはホールドをオフにする日付を設定するまで処理されません。 このようにした理由は次のとおりです。 メールボックスにインポートされたメッセージは古くなると、完全に削除 (パージ) される可能性があります。これは、メッセージの保持期限がメールボックスに対して構成されたアイテム保持設定に基づいているためです。 メールボックスに対してアイテム保持ホールドが設定されると、メールボックスの所有者は、新たにインポートされたメッセージを管理する時間、またはメールボックスのアイテム保持設定を変更する時間を確保できます。 アイテム保持ホールドの管理に関する推奨事項については、この記事の 「[詳細情報](#more-information)」セクションを参照してください。

- 既定では、Microsoft 365 メールボックスで受信できるメッセージの最大サイズは 35 MB です。 これは、メールボックスの *MaxReceiveSize* プロパティの既定値が 35 MB に設定されているためです。 ただし、Microsoft 365 のメッセージ受信最大サイズの上限は 150 MB です。 そのため、35 MB より大きいアイテムを含む PST ファイルをインポートすると、Microsoft 365 インポート サービスにより、対象メールボックスの *MaxReceiveSize* プロパティの値が 150 MB に自動的に変更されます。 これにより、最大 150 MB のメッセージをユーザーのメールボックスにインポートできます。

    > [!TIP]
    > メッセージ受信サイズを識別するには、Exchange Online PowerShell で次のコマンドを実行します: `Get-Mailbox <user mailbox> | FL MaxReceiveSize`

- PST インポート プロセスの概要については、この記事の「[インポート プロセスの流れ](#how-the-import-process-works)」セクションをご覧ください。

## <a name="step-1-copy-the-sas-url-and-download-azcopy"></a>手順 1: SAS URL をコピーして AzCopy をダウンロードする

まず、AzCopy ツールをダウンロードしてインストールします。これは、手順 2 で PST ファイルを Microsoft 365 にアップロードするために実行するツールです。 組織の SAS URL もコピーします。 この URL は、組織の Microsoft クラウドにある Azure Storage の場所のネットワーク URL と、Shared Access Signature (SAS) キーの組み合わせです。 このキーでは、Azure Storage の場所に PST ファイルをアップロードするために必要な権限が与えられます。 必ず SAS URL を保護するための予防措置を講じてください。 これらは組織に固有で、手順 2 で使用されます。

> [!IMPORTANT]
> この記事で説明するネットワーク アップロードの方法とコマンド構文を使用して PST ファイルをインポートするには、下の手順 6b でダウンロードできるバージョンの AzCopy を使用する必要があります。 また、同バージョンの AzCopy は、[こちら](https://aka.ms/downloadazcopylatest)からもダウンロードできます。 これ以外のバージョンの AzCopy の使用はサポートされていません。
  
1. <https://compliance.microsoft.com> に移動し、組織の管理者アカウントの資格情報を使用してサインインします。

2. コンプライアンス ポータルの左側のウィンドウで、[**データ ライフサイクル管理** \> **] Microsoft 365** **[Microsoft 365** \> \> インポート] を選択 **します**。

    > [!NOTE]
    > コンプライアンス ポータルの **[インポート]** ページにアクセスするには、適切なアクセス許可が割り当てられている必要があります。詳細については、「**開始する前に**」のセクションを参照してください。 

3. [**インポート**] タブで、[![追加アイコン](../media/ITPro-EAC-AddIcon.gif)] > [**新規インポート ジョブ**] の順にクリックします。

    ジョブのインポート ウィザードが表示されます。

4. PST インポート ジョブの名前を入力し、[**次へ**] をクリックします。 小文字の英字、数字、ハイフン、およびアンダー スコアを使用します。 大文字を使用したり、名前にスペースを含めたりすることはできません。

5. [**データをアップロードまたは配送しますか?**] ページで、[**データをアップロードする**] をクリックし、[**次へ**] をクリックします。

    ![[データをアップロードする] をクリックして、ネットワーク アップロードのインポート ジョブを作成します。](../media/e59f9dc3-ccde-44ff-ac38-c4e39d76ae85.png)
  
6. [**データのインポート**] ページで、次の 2 つの操作を行います。

    ![[データのインポート] ページで SAS URL をコピーして AzCopy ツールをダウンロードします。](../media/74411014-ec4b-4e25-9065-404c934cce17.png)
  
    1. 手順 2 で、[**ネットワーク アップロード SAS URL を表示する**] をクリックします。SAS URL が表示されたら、[**クリップボードにコピー**] をクリックしてから、ファイルに貼り付けて保存し、後でアクセスできるようにします。

    2. 手順 3 で、[**Azure AzCopy のダウンロード**] をクリックし、AzCopy ツールをローカル コンピューターにダウンロードします。 このバージョンの AzCopy は単なる実行可能ファイルであるため、インストールするものはありません。

   > [!NOTE]
   > [**データのインポート**] ページを開いたままにしておくか (もう一度 SAS URL をコピーする必要がある場合)、[**キャンセル**] をクリックして閉じることができます。

## <a name="step-2-upload-your-pst-files-to-microsoft-365"></a>手順 2: Microsoft 365 に PST ファイルをアップロードする

これで、AzCopy ツールを使って Microsoft 365 に PST ファイルをアップロードする準備が整いました。 このツールは、PST ファイルを Microsoft が提供する Microsoft クラウドの Azure Storage の場所にアップロードして保存します。 前述したように、PST ファイルをアップロードする Azure Storage の場所は、組織が所在するのと同じ地域の Microsoft データ センターにあります。 この手順を完了するには、PST ファイルを組織内のファイル共有またはファイル サーバー、または組織で管理されている Azure Storage の場所に配置する必要があります。 PST の保存場所は、この手順でソースの場所と呼ばれます。 AzCopy ツールを実行するたびに、別のソースの保存場所を指定できます。

> [!NOTE]
> 前述したように、Azure Storage の場所にアップロードするそれぞれの PST ファイルは、20 GB 以下にする必要があります。 PST ファイルが 20 GB を超える場合、手順 6 で開始する PST インポートプロセスのパフォーマンスに影響を与える可能性があります。 また、各 PST ファイルには一意の名前が必要です。

1. ローカル コンピューターでコマンド プロンプトを開きます。

2. 手順 1 で azcopy.exe ファイルをダウンロードしたディレクトリに移動します。

3. 次のコマンドを実行して、PST ファイルを Microsoft 365 にアップロードします。

    ```powershell
    azcopy.exe copy "<Source location of PST files>" "<SAS URL>"
    ```

    > [!IMPORTANT]
    > 前のコマンドで、ソースの場所としてディレクトリまたは Azure Storage の場所を指定できます。個々の PST ファイルを指定することはできません。ソースの場所にあるすべての PST ファイルがアップロードされます。

    次の表は、azcopy.exe のフィールドとそれに必要な値を説明したものです。前の手順で取得した情報は、これらのフィールドの値に使用されます。

    | Field | 説明 |
    |:-----|:-----|
    | ソース |最初のフィールドは、Microsoft 365 にアップロードされる PST ファイルを含む組織内のソース ディレクトリを指定します。 または、アップロードする PST ファイルのソースの場所として、Azure Storage の場所を指定することもできます。 <br/> このフィールドの値は必ず二重引用符 (" ") で囲むようにしてください。  <br/> <br/>**例**: <br/>`"\\FILESERVER01\PSTs"` <br/> または  <br/>`"https://storageaccountid.blob.core.windows.net/PSTs?sp=racwdl&st=2021-09-21T07:25:53Z&se=2021-09-21T15:25:53Z&sv=2020-08-04&sr=c&sig=xxxxxx"`|  
    | Destination (転送先) |手順 1 で取得した SAS URL を指定します。  <br/> このパラメーターの値は必ず二重引用符 (" ") で囲むようにしてください。<br/><br/>**注:** スクリプトまたはバッチ ファイルで SAS URL を使用している場合は、エスケープする必要がある特定の文字に注意する必要があります。たとえば、`%` を `%%` に変更し、`&` を `^&` に変更してください。<br/><br/>**ヒント:** (省略可能) PST ファイルをアップロードする Azure Storage の場所にサブフォルダーを指定できます。 SAS URL で ("ingestiondata" の後に) サブフォルダーの場所を追加してこの操作を行います。 最初の例では、サブフォルダーを指定しません。 つまり PST ファイルは Azure Storage ロケーションのルート (名前付き *ingestiondata*) にアップロードされます。 2 つ目の例では、PST ファイルを Azure Storage の場所のルートにある (*PSTFiles* という名前の) サブフォルダーにアップロードします。  <br/><br/>**例**: <br/> `"https://3c3e5952a2764023ad14984.blob.core.windows.net/ingestiondata?sv=2012-02-12&amp;se=9999-12-31T23%3A59%3A59Z&amp;sr=c&amp;si=IngestionSasForAzCopy201601121920498117&amp;sig=Vt5S4hVzlzMcBkuH8bH711atBffdrOS72TlV1mNdORg%3D"` <br/> または  <br/>  `"https://3c3e5952a2764023ad14984.blob.core.windows.net/ingestiondata/PSTFiles?sv=2012-02-12&amp;se=9999-12-31T23%3A59%3A59Z&amp;sr=c&amp;si=IngestionSasForAzCopy201601121920498117&amp;sig=Vt5S4hVzlzMcBkuH8bH711atBffdrOS72TlV1mNdORg%3D"` <br/> |
    | `--recursive` |このオプションのフラグによって再帰モードが指定され、AzCopy ツールがソース フィールドで指定され、ソース ディレクトリのサブフォルダーにある PST ファイルをコピーするようになります。このフラグの既定値は `true` です。 <br/>**注:** このフラグを含めると、サブフォルダー内の PST ファイルには、アップロード後、Azure ストレージの場所に別のファイルのパス名が指定されます。手順 4 で作成した CSV ファイルの正確なファイルのパス名を指定する必要があります。|
    | `--s2s-preserve-access-tier` | このオプション フラグは、ソースの場所がアクセス層をサポートする汎用 v2 Azure Storage の場所である場合にのみ必要です。 PST インポート シナリオでは、 PST ファイルを Azure Storage アカウントから Microsoft が提供する Azure Storage の場所にコピーするときに、アクセス層を保持する必要はありません。 この場合、このフラグを含め、`false` の値を使用できます。 アクセス層をサポートしていないクラシック Azure Storage アカウントから PST ファイルをコピーする場合は、このフラグを使用する必要はありません。|
   |||

**azcopy.exe コピー** コマンドの詳細については、「[azcopy のコピー](/azure/storage/common/storage-ref-azcopy-copy)」を参照してください。

各パラメーターの実際の値を使う AzCopy ツールの構文の例を以下に示します。

### <a name="example-1"></a>例 1

これは、ファイル サーバーまたはローカル コンピューターにあるソース ディレクトリの例です。

```powershell
azcopy.exe copy "\\FILESERVER1\PSTs" "https://3c3e5952a2764023ad14984.blob.core.windows.net/ingestiondata?sv=2012-02-12&amp;se=9999-12-31T23%3A59%3A59Z&amp;sr=c&amp;si=IngestionSasForAzCopy201601121920498117&amp;sig=Vt5S4hVzlzMcBkuH8bH711atBffdrOS72TlV1mNdORg%3D"
```

### <a name="example-2"></a>例 2

これは、サブディレクトリを持つクラシック Azure Storage アカウントにあるソース ディレクトリの例です。

```powershell
azcopy.exe copy "https://storageaccountid.blob.core.windows.net/PSTs?sp=racwdl&st=2021-09-21T07:25:53Z&se=2021-09-21T15:25:53Z&sv=2020-08-04&sr=c&sig=xxxxxx" "https://3c3e5952a2764023ad14984.blob.core.windows.net/ingestiondata?sv=2012-02-12&amp;se=9999-12-31T23%3A59%3A59Z&amp;sr=c&amp;si=IngestionSasForAzCopy201601121920498117&amp;sig=Vt5S4hVzlzMcBkuH8bH711atBffdrOS72TlV1mNdORg%3D" --recursive
```

### <a name="example-3"></a>例 3

これは、汎用 v2 Azure Storage アカウントにあるソース ディレクトリの例です。 アクセス層は、PST ファイルのアップロード時には保持されません。

```powershell
azcopy.exe copy "https://storageaccountid.blob.core.windows.net/PSTs?sp=racwdl&st=2021-09-21T07:25:53Z&se=2021-09-21T15:25:53Z&sv=2020-08-04&sr=c&sig=xxxxxx" "https://3c3e5952a2764023ad14984.blob.core.windows.net/ingestiondata?sv=2012-02-12&amp;se=9999-12-31T23%3A59%3A59Z&amp;sr=c&amp;si=IngestionSasForAzCopy201601121920498117&amp;sig=Vt5S4hVzlzMcBkuH8bH711atBffdrOS72TlV1mNdORg%3D" --s2s-preserve-access-tier=false
```

コマンドを実行すると、PST ファイルのアップロードの進行状況を示す状態メッセージが表示されます。最終の状態メッセージは、正常にアップロードされたファイルの合計数を示しています。

> [!TIP]
> **azcopy.exe のコピー** を正常に実行して、すべてのパラメーターが正しいことを確認した後、コマンド ライン構文のコピーを、手順 1 で取得した情報をコピーしたファイルと同じ (セキュリティで保護された) ファイルに保存します。これで、AzCopy ツールを実行して、PST ファイルを Microsoft 365 にアップロードするたびに、コマンド プロンプトにこのコマンドをコピーして貼り付けることができます。変更する必要のある値は、ソース フィールドの値のみです。これは、PST ファイルがあるソース ディレクトリによって異なります。

## <a name="optional-step-3-view-a-list-of-the-pst-files-uploaded-to-microsoft-365"></a>(オプション) 手順 3: Microsoft 365 にアップロードされた PST ファイルのリストを表示する

オプションの手順として、Microsoft Azure Storage Explorer (無料のオープン ソース ツール) をインストールして使用し、Azure BLOB にアップロードした PST ファイルのリストを表示できます。これを行うには 2 つの理由があります。
  
- 共有フォルダーまたは組織内のファイル サーバーから PST ファイルが Azure BLOB に正常にアップロードされたことを確認します。

- 各 PST ファイルのファイル名 (およびファイル名が含まれている場合はサブフォルダーのパス名) が Azure BLOB にアップロードされたことを確認します。 次の手順で PST マッピング ファイルを作成する際、各 PST ファイルに対しファイル名とフォルダーのパス名の両方を指定する必要があるため、この機能は便利です。 この名前を確認すると、PST マッピング ファイル内の潜在的なエラーを削減できます。

通常、Azure Storage Explorer のスタンドアロン アプリケーションが使用できます。 次の手続きでリンクを使用して、最新バージョンをダウンロードできます。
  
> [!IMPORTANT]
> Azure Storage Explorer で PST ファイルをアップロードまたは変更することはできません。PST ファイルをインポートするには、AzCopy を使用する方法のみがサポートされています。また、Azure BLOB にアップロードした PST ファイルを削除することはできません。PST ファイルを削除しようとすると、必要なアクセス許可がないというエラーが表示されます。すべての PST ファイルは、Azure Storage 領域から自動的に削除されます。進行中のインポート ジョブがない場合は、**ingestiondata** コンテナー内の PST ファイルはすべて、最後のインポート ジョブの作成から 30 日後に削除されます。
  
Azure Storage Explorer をインストールし、Azure Storage 領域に接続するには:
  
1. [Microsoft Azure Storage Explorer ツール](https://go.microsoft.com/fwlink/p/?LinkId=544842)をダウンロードしてインストールします。

2. Microsoft Azure Storage Explorer を開始します。

3. **[Azure Storage に接続する]** ダイアログの **[リソースの選択]** ページで、**[BLOB コンテナー]** をクリックします。
  
4. **[認証方法の選択]** ページで、**[Shared access signature (SAS)]** オプションを選択し、**[次へ]** をクリックします。

5. [**接続情報の入力]** ページで、手順 1 で取得した SAS URL を **[BLOB コンテナー SAS URL]** の下のボックスに貼り付け、**[次へ]** をクリックします。 SAS URL を貼り付けると、**[表示名]** の下のボックスに **ingestiondata** が自動的に入力されます。

6. **[概要]** ページで、接続情報を確認して **[接続]** をクリックします。

    **Ingestiondata** コンテナーが開きます。 これには手順 2 でアップロードした PST ファイルが含まれています。 **ingestiondata** コンテナーは、[**ストレージ アカウント**] \> **(接続コンテナー)** \> [**BLOB コンテナー**] にあります。 
  
7. Microsoft Azure Storage Explorer の使用が完了したら、**ingestiondata** を右クリックし、[**デタッチ**] をクリックすると Azure Storage 領域から切断されます。 切断しない場合、次に接続しようとするとエラーが表示されます。
  
## <a name="step-4-create-the-pst-import-mapping-file"></a>手順 4: PST インポート マッピング ファイルを作成する

PST ファイルを組織の Azure Storage の場所にアップロードしたら、次は、コンマ区切り値 (CSV) のファイルを作成して、PST ファイルのインポート先のユーザー メールボックスを指定します。PST インポート ジョブを作成する場合は、次の手順でこの CSV ファイルを送信します。
  
1. [PST インポート マッピング ファイルのコピーをダウンロードします](https://go.microsoft.com/fwlink/p/?LinkId=544717)。

2. CSV ファイルを開くか、ローカル コンピューターに保存します。次の例は、完了した PST インポートのマッピング ファイル (メモ帳で開いた) を示しています。Microsoft Excel を使って CSV ファイルを編集するほうが、はるかに簡単です。

    ```console
    Workload,FilePath,Name,Mailbox,IsArchive,TargetRootFolder,ContentCodePage,SPFileContainer,SPManifestContainer,SPSiteUrl
    Exchange,,annb.pst,annb@contoso.onmicrosoft.com,FALSE,/,,,,
    Exchange,,annb_archive.pst,annb@contoso.onmicrosoft.com,TRUE,,,,,
    Exchange,,donh.pst,donh@contoso.onmicrosoft.com,FALSE,/,,,,
    Exchange,,donh_archive.pst,donh@contoso.onmicrosoft.com,TRUE,,,,,
    Exchange,PSTFiles,pilarp.pst,pilarp@contoso.onmicrosoft.com,FALSE,/,,,,
    Exchange,PSTFiles,pilarp_archive.pst,pilarp@contoso.onmicrosoft.com,TRUE,/ImportedPst,,,,
    Exchange,PSTFiles,tonyk.pst,tonyk@contoso.onmicrosoft.com,FALSE,,,,,
    Exchange,PSTFiles,tonyk_archive.pst,tonyk@contoso.onmicrosoft.com,TRUE,/ImportedPst,,,,
    Exchange,PSTFiles,zrinkam.pst,zrinkam@contoso.onmicrosoft.com,FALSE,,,,,
    Exchange,PSTFiles,zrinkam_archive.pst,zrinkam@contoso.onmicrosoft.com,TRUE,/ImportedPst,,,,
    ```

    CSV ファイルの先頭行やヘッダー行には、PST ファイルをユーザー メールボックスにインポートするために PST インポート サービスで使うパラメーターが一覧表示されます。各パラメーター名はコンマで区切られています。見出し行の下の各行は、PST ファイルを特定のメールボックスにインポートするためのパラメーター値を表します。ユーザー メールボックスにインポートする各 PST ファイルには行が必要です。CSV マッピング ファイルに含めることができる最大行数は 500 行です。500 個を超える PST ファイルをインポートするには、複数のマッピング ファイルを作成し、手順 5 で複数のインポート ジョブを作成する必要があります。

    > [!NOTE]
    > SharePoint パラメーターなど、ヘッダー行は何も変更しないでください。これらは PST インポートの処理中、無視されます。 また、必ずマッピング ファイル内のプレースホルダーのデータを実際のデータに置き換えてください。

3. 次の表の情報を使って、必要な情報を含む CSV ファイルを作成します。

    | パラメーター | 説明 | 例 |
    |:-----|:-----|:-----|
    | `Workload` <br/> |データのインポート先のサービスを指定します。ユーザー メールボックスに PST ファイルをインポートするには、`Exchange` を使用します。  <br/> | `Exchange` <br/> |
    | `FilePath` <br/> |手順 2 で PST ファイルをアップロードした Azure Storage の場所でフォルダーの場所を指定します。  <br/> 手順 2 の `/Dest:` パラメーターの SAS URL にオプションのサブフォルダー名を入れなかった場合は、CSV ファイルのこのパラメーターを空白のままにしておきます。 サブフォルダー名を入れた場合は、このパラメーターでその名前を指定します (2 つ目の例を参照)。 このパラメーターの値には、大文字と小文字の区別があります。  <br/> どちらの場合でも、`FilePath` パラメーターの値に "ingestiondata" を含め *ない* でください。  <br/><br/> **重要:** 手順 2 でコピー先フィールドに SAS URL の省略可能なサブフォルダー名を含めた場合、ファイル パス名の大文字小文字はそのとき使用したものと同じである必要があります。 たとえば、手順 2 でサブフォルダー名として `PSTFiles` を使用した場合、CSV ファイル内の `FilePath` パラメーターに `pstfiles` を使用すると、PST ファイルのインポートは失敗します。 必ず、両方のインスタンスの大文字と小文字を同じにしてください。  <br/> |(空白のまま)  <br/> または  <br/>  `PSTFiles` <br/> |
    | `Name` <br/> |ユーザー メールボックスにインポートする PST ファイルの名前を指定します。 このパラメーターの値には、大文字と小文字の区別があります。 インポート ジョブ用のマッピング ファイル内の各 PST ファイルのファイル名は一意である必要があります。 <br/> <br/>**重要:** CSV ファイル内の PST ファイル名の大文字と小文字は、手順 2 で Azure Storage の場所にアップロードした PST ファイルの場合と同じである必要があります。 たとえば、CSV ファイル内の `Name` パラメーターでは `annb.pst` を使用していますが、実際の PST ファイルの名前は `AnnB.pst` である場合、その PST ファイルのインポートは失敗します。 CSV ファイル内の PST の名前の大文字小文字は、実際の PST ファイルの場合と同じである必要があります。  <br/> | `annb.pst` <br/> |
    | `Mailbox` <br/> |PST ファイルのインポート先になるメールボックスのメールアドレスを指定します。 PST インポート サービスでは PST ファイルまたは統合グループをパブリック フォルダーにインポートすることはサポートされていないため、パブリック フォルダーまたは統合グループを指定することはできません。  <br/> PST ファイルを非アクティブなメールボックスにインポートするには、このパラメーターにメールボックスの GUID を指定する必要があります。 この GUID を取得するには、Exchange Onlineで次の PowerShell コマンドを実行します`Get-Mailbox <identity of inactive mailbox> -InactiveMailboxOnly`。 | `FL Guid` <br/> **注意:** 1 つのメール アドレスに対して複数のメールボックスが存在することがあります。この場合、1 つのメールボックスがアクティブ状態となり、他のメールボックスは論理的に削除された (非アクティブな) 状態となります。 このような状況で、PST ファイルのインポート先のメールボックスを一意に識別するには、メールボックスの GUID を指定する必要があります。 アクティブなメールボックスの GUID を取得するには、次の PowerShell コマンドを実行します: `Get-Mailbox <identity of active mailbox>` | `FL Guid`. 論理的に削除された (非アクティブな) メールボックスの GUID を取得するには、次のコマンドを実行します: `Get-Mailbox \<identity of soft-deleted or inactive mailbox\> -SoftDeletedMailbox | FL Guid`  <br/> | `annb@contoso.onmicrosoft.com` <br/> または  <br/>  `2d7a87fe-d6a2-40cc-8aff-1ebea80d4ae7` <br/> |
    | `IsArchive` <br/> | PST ファイルをユーザーのアーカイブ メールボックスにインポートするかどうかを指定します。次のような 2 つの選択肢があります。<br/><br/>**FALSE:** PST ファイルをユーザーのプライマリ メールボックスにインポートします。  <br/> **TRUE:** PST ファイルをユーザーのアーカイブ メールボックスにインポートします。 これは、[ユーザーのアーカイブ メールボックスが有効である](enable-archive-mailboxes.md)ことが前提です。 <br/><br/>このパラメーターが `TRUE` に設定されている場合に、ユーザーのアーカイブ メールボックスが有効になっていない場合は、そのユーザーのインポートは失敗します。(アーカイブが有効化されていないにもかかわらずこのプロパティが `TRUE` に設定されたことが原因で) あるユーザーのインポートが失敗しても、そのインポート ジョブ内の他のユーザーが影響を受けることはありません。<br/>  このパラメーターを空白のままにすると、PST ファイルはユーザーのプライマリ メールボックスにインポートされます。  <br/> <br/>**注:** PST ファイルをクラウド ベースのアーカイブ メールボックスにインポートするときに、そのユーザーのプライマリ メールボックスがオンプレミスの場合は、このパラメーターに対して `TRUE` を指定し、そのユーザーのオンプレミスのメールボックスのメール アドレスを `Mailbox` パラメーターで指定してください。  <br/> | `FALSE` <br/> または  <br/>  `TRUE` <br/> |
    | `TargetRootFolder` <br/> | PST ファイルのインポート先のメールボックス フォルダーを指定します。  <br/> <br/> このパラメーターを空白のままにすると、PST ファイルはメールボックスのルート レベル (受信トレイ フォルダーや他の既定のメールボックス フォルダーと同じレベル) で **インポート済み** という新しいフォルダーにインポートされます。  <br/> <br/> `/` を指定する場合、対象のメールボックスまたはアーカイブのフォルダー構造の最上位に、PST ファイルのフォルダーとアイテムが復元されます。 対象のメールボックスにフォルダー (たとえば、[受信トレイ]、[送信済みアイテム]、[削除済みアイテム] などの既定のフォルダー) がある場合、PST 内のそのフォルダーのアイテムは、対象のメールボックスの既存のフォルダーに結合されます。 たとえば、PST ファイルに [受信トレイ] フォルダーが含まれている場合、そのフォルダー内のアイテムは対象のメールボックスの [受信トレイ] フォルダーにインポートされます。 新しいフォルダーは、対象のメールボックスのフォルダー構造にない場合に作成されます。  <br/><br/>  `/<foldername>` を指定した場合、PST ファイルのアイテムとフォルダーは *\<foldername\>* というフォルダーにインポートされます。 たとえば、`/ImportedPst` を使用した場合、アイテムは **ImportedPst** というフォルダーにインポートされます。 このフォルダーは、ユーザーのメールボックスの受信トレイ フォルダーと同じレベルにあります。  <br/><br/> **ヒント:** PST ファイルのインポート先に最適なフォルダーの場所を決定できるよう、このパラメーターで試すテスト バッチをいくつか実行することを検討してください。   <br/> |(空白のまま)  <br/> または  <br/>  `/` <br/> または  <br/>  `/ImportedPst` <br/> |
    | `ContentCodePage` <br/> |この省略可能なパラメーターでは、PST ファイルを ANSI ファイル形式でインポートする場合に使用するコード ページの数値を指定します。 このパラメーターは、中国語、日本語、韓国語 (CJK) を使用する組織から PST ファイルをインポートする場合に使用します。通常、これらの言語は、文字エンコードのために 2 バイト文字セット (DBCS) を使用するからです。 メールボックス フォルダー名に DBCS が使用されている言語については、PST ファイルのインポートの際にこのパラメーターを使用しないと、多くの場合、インポート後にフォルダー名の文字化けが発生します。  <br/><br/> このパラメーターに使用できる値のリストについては、「[Code Page Identifiers](/windows/win32/intl/code-page-identifiers)」 (コード ページ識別子) を参照してください。  <br/> <br/>**注:** 前述したように、これは省略可能なパラメーターであり、CSV ファイルに含めなくてもかまいません。 または、このパラメーターを含め、1 つまたは複数の行について値を空白のままにしておくこともできます。  <br/> |(空白のまま)  <br/> または  <br/>  `932` (ANSI/OEM 日本語のコード ページ ID)  <br/> |
    | `SPFileContainer` <br/> |PST インポートの場合は、このパラメーターを空白のままにします。  <br/> |該当なし  <br/> |
    | `SPManifestContainer` <br/> |PST インポートの場合は、このパラメーターを空白のままにします。  <br/> |該当なし  <br/> |
    | `SPSiteUrl` <br/> |PST インポートの場合は、このパラメーターを空白のままにします。  <br/> |該当なし  <br/> |

## <a name="step-5-create-a-pst-import-job"></a>手順 5: PST インポート ジョブを作成する

次の手順では、Microsoft 365 のインポート サービスで PST インポート ジョブを作成します。 前述したように、手順 4 で作成した PST インポートのマッピング ファイルを送信します。 ジョブを作成した後に、Microsoft 365 は PST ファイル内のデータを分析し、実際に PST インポート マッピング ファイル ([手順 6](#step-6-filter-data-and-start-the-pst-import-job) を参照) で指定したメールボックスにインポートするデータをフィルター処理する機会を提供します。
  
1. <https://compliance.microsoft.com> に移動し、組織の管理者アカウントの資格情報を使用してサインインします。

2. コンプライアンス ポータルの左側のウィンドウで、 **データ ライフサイクル管理** > **Microsoft 365** > Import** を選択します。

3. [**インポート**] タブで、[![追加アイコン](../media/ITPro-EAC-AddIcon.gif)] > [**新規インポート ジョブ**] の順にクリックします。

   > [!NOTE]
   > コンプライアンス ポータルの **[インポート]** ページにアクセスしてインポート ジョブを作成するには、適切なアクセス許可が割り当てられていることが必要です。詳細については、「**PST ファイルのインポートを開始する前に**」セクションを参照してください。 

4. PST インポート ジョブの名前を入力し、[**次へ**] をクリックします。 小文字の英字、数字、ハイフン、およびアンダー スコアを使用します。 大文字を使用したり、名前にスペースを含めたりすることはできません。

5. [**データをアップロードまたは配送しますか?**] ページで、[**データをアップロードする**] をクリックし、[**次へ**] をクリックします。
  
6. 手順 4 の [**データのインポート**] ページで、[**ファイルをアップロードしました**] と [**マッピング ファイルにアクセスできます**] チェック ボックスを選択して、[**次へ**] をクリックします。

    ![手順 4 で 2 つのチェック ボックスをクリックします。](../media/9f2427e8-3af2-4e27-95e6-a9f08430d3d8.png)
  
7. [**マッピング ファイルの選択**] ページで、[**マッピング ファイルの選択**] をクリックし、手順 4 で作成した CSV マッピング ファイルを送信します。

    ![[マッピング ファイルの選択] をクリックして、インポート ジョブのために作成した CSV ファイルを送信します。](../media/d30b1d73-80bb-491e-a642-a21673d06889.png)
  
8. CSV ファイルの名前が [**マッピング ファイル名**] に表示されたら、[**検証**] をクリックし、CSV ファイルでエラーを確認します。

    ![[検証] をクリックして CSV ファイルでエラーを確認します。](../media/4680999d-5538-4059-b878-2736a5445037.png)
  
    PST インポート ジョブを作成するには、CSV ファイルが正常に検証される必要があります。 正常に検証されると、ファイル名が緑色に変わります。 検証が失敗した場合は、[**ログの表示**] リンクをクリックします。 検証エラー レポートを開くと、失敗したファイルの各行にエラー メッセージが表示されます。

   > [!NOTE]
   > 上で説明したように、CSV マッピング ファイルに含めることができる最大行数は 500 行です。 マッピング ファイルに 500 行を超える行が含まれる場合、検証は失敗します。 500 個を超える PST ファイルをインポートするには、複数のマッピング ファイルを作成して複数のインポート ジョブを作成する必要があります。

9. マッピング ファイルが正常に検証された後に、利用条件のドキュメントを読み、チェックボックスをクリックします。

10. [**保存**] をクリックしてジョブを送信し、ジョブが正常に作成されたら [**閉じる**] をクリックします。

    [**分析の進行中**] のステータスを示すステータス用のポップアップ ページが表示され、新しいインポート ジョブが [**PST ファイルのインポート**] ページのリストに表示されます。

11. [**更新**] ![更新アイコン](../media/O365-MDM-Policy-RefreshIcon.gif)をクリックします。 [**ステータス**] 列に表示されるステータス情報を更新します。 分析が完了し、データをインポートする準備ができると、ステータスが [**分析完了**] に変わります。

    インポート ジョブをクリックしてステータス フライアウト ページを表示することができます。このページにはマッピング ファイルにリストされている各 PST ファイルのステータスなどのインポート ジョブに関する詳細が表示されます。

## <a name="step-6-filter-data-and-start-the-pst-import-job"></a>手順 6: データをフィルター処理して、PST インポート ジョブを開始する

手順 5 でインポート ジョブを作成した後、Microsoft 365 は、セキュリティで保護された安全な方法で PST ファイル内のデータを分析します。具体的には、アイテムの経過時間と、PST ファイルに含まれるさまざまなメッセージの種類を識別します。 分析が完了し、データをインポートする準備ができたら、PST ファイルに含まれるすべてのデータをインポートするか、インポートするデータをトリミングするかを選ぶことができます。データをトリミングする場合は、インポートするデータを制御するフィルターを設定します。
  
1. コンプライアンス ポータルの [**インポート**] タブで、手順 5 で作成したインポート ジョブを選択し、[**Microsoft 365 にインポート**] をクリックします。
  
   [**データのフィルター処理**] ページが表示されます。 ここには、データの使用期間に関する情報など、Microsoft 365 によって実行された PST ファイルの分析の結果のデータ情報が含まれます。 この時点で、インポートされるデータにフィルター処理を適用するか、すべてのデータをそのままインポートするかを選択できます。 

    ![PST ファイルのデータをトリミングしたり、そのすべてをインポートしたりすることができます。](../media/287fc030-99e9-417b-ace7-f64617ea5d4e.png)
  
2. 次のいずれかの操作を行います。

   1. インポートするデータをトリミングする場合は [**はい、インポートする前にフィルター処理します**] をクリックします。

      PST ファイル内のデータをフィルター処理してインポート ジョブを開始する手順の詳細については、「[Microsoft 365 に PST ファイルをインポートするときにデータをフィルター処理する](filter-data-when-importing-pst-files.md)」を参照してください。

      または

   2.  PST ファイル内のすべてのデータをインポートするには、[**いいえ、すべてのアイテムをインポートします**] をクリックして、[**次へ**] をクリックします。

3. すべてのデータをインポートする場合は、[**データのインポート**] をクリックしてインポート ジョブを開始します。 

   インポート ジョブのステータスが [**PST ファイルのインポート**] ページに表示されます。 ![[最新の情報に更新] アイコン](../media/O365-MDM-Policy-RefreshIcon.gif)をクリックします。 [**最新の情報に更新**] して、[**ステータス**] 列に表示されるステータス情報を更新します。 インポート ジョブをクリックするとステータス フライアウト ページが表示され、インポートされている各 PST ファイルに関するステータス情報が表示されます。

## <a name="more-information"></a>詳細情報

- Microsoft 365 に PST ファイルをインポートするのはなぜですか?

  - 組織のアーカイブ メッセージング データを Microsoft 365 にインポートする方法として役立つからです。

  - データがクラウドに格納されるので、ユーザーはあらゆるデバイスからデータを利用できます。

  - この機能は、インポートした PST ファイルのデータに Microsoft Purview 機能を適用することで、組織のコンプライアンスのニーズに対応するのに役立ちます。対象は次のとおりです。

  - [アーカイブ メールボックス](enable-archive-mailboxes.md)と[自動拡張アーカイブ](enable-autoexpanding-archiving.md)を有効にして、インポートしたデータを保存するための追加のメールボックス記憶域をユーザーに与える。

  - メールボックスを[訴訟ホールド](./create-a-litigation-hold.md)に配置して、インポートしたデータを保持する。

  - Microsoft [電子情報開示ツール](search-for-content.md)を使用して、インポートしたデータを検索する。

  - [Microsoft 365 アイテム保持ポリシー](retention.md)を使用して、インポートしたデータの保持期間、および保持期間の経過後に実行するアクションを制御する。

  - インポートしたデータに影響を与えるメールボックス関連イベントを、[監査ログ](search-the-audit-log-in-security-and-compliance.md)で検索する。

  - データを[非アクティブなメールボックス](inactive-mailboxes-in-office-365.md)にインポートして、コンプライアンスのためにデータをアーカイブする。 

  - [データ損失防止ポリシー](dlp-learn-about-dlp.md)を使用して、機密データが組織外に漏洩するのを防ぐ。

- 前述したように、Microsoft 365 インポート サービスは PST ファイルがメールボックスにインポートされた後、アイテム保持ホールド設定を (無期限に) オンにします。 これは、*RetentionHoldEnabled* プロパティが **True** に設定されているため、メールボックスに割り当てられたアイテム保持ポリシーが処理されないことを意味します。 これによりメールボックスの所有者は、古くなったメッセージが削除ポリシーまたはアーカイブ ポリシーによって削除またはアーカイブされるのを回避し、新たにインポートしたメッセージを管理する時間を確保できます。 このアイテム保持ホールドを管理するための手順を以下に示します。

  - 一定時間後、**Set-Mailbox -RetentionHoldEnabled $false** コマンドを実行することによりアイテム保持ホールドをオフにできます。 手順については、「[メールボックスの保存機能を有効にする](/exchange/security-and-compliance/messaging-records-management/mailbox-retention-hold)」を参照してください。

  - 将来の特定の日付にオフになるようにアイテム保持ホールドを構成することができます。 これを行うには、**Set-Mailbox -EndDateForRetentionHold *date*** コマンドを実行します。 たとえば、今日の日付が 2016 年 6 月 1 日であり、30 日後にアイテム保持ホールドをオフにする場合は、コマンド **Set-Mailbox -EndDateForRetentionHold 7/1/2016** を実行します。 このシナリオでは、**RentionHoldEnabled** プロパティを *True* に設定したままにします。 詳細については、「[Set-Mailbox](/powershell/module/exchange/set-mailbox)」を参照してください。

  - メールボックスに割り当てられているアイテム保持ポリシーの設定を変更して、インポート済みの古いアイテムがすぐに削除されたり、ユーザーのアーカイブ メールボックスに移動されたりしないようにすることができます。 たとえば、メールボックスに割り当てられた削除ポリシーまたはアーカイブ ポリシーの保持期間を長くすることができます。 このシナリオでは、アイテム保持ポリシーの設定を変更した後で、メールボックスに対するアイテム保持ホールドをオフにします。 詳細については、「[組織のメールボックスのアーカイブと削除ポリシーを設定する](set-up-an-archive-and-deletion-policy-for-mailboxes.md)」を参照してください。

### <a name="how-the-import-process-works"></a>インポート プロセスの流れ
  
ネットワークのアップロード オプションおよび Microsoft 365 のインポート サービスを使用して、ユーザーのメールボックスに PST ファイルを一括インポートすることができます。 ネットワーク アップロードとは、Microsoft クラウドの一時的な記憶域に PST ファイルをアップロードすることを意味します。 その後、Microsoft 365 インポート サービスが記憶域からユーザーのメールボックスに PST ファイルをコピーします。
  
ここでは、PST ファイルを Microsoft 365 のメールボックスにインポートするためのネットワーク アップロード処理の図と説明を示します。
  
![PST ファイルを Microsoft 365 にインポートするためのネットワーク アップロード プロセスのワークフロー。](../media/9e05a19e-1e7a-4f1f-82df-9118f51588c4.png)
  
1. **PST インポート ツールとキーを Azure Storage のプライベートな場所にダウンロードする:** まず、PST ファイルを Microsoft クラウドの Azure Storage の場所にアップロードするために使用する AzCopy コマンドライン ツールとアクセス キーをダウンロードします。 これらは、コンプライアンス ポータルの [**インポート**] ページで取得します。 このキー (Secure Access Signature (SAS) キーと呼ばれます) は、ユーザーに、PST ファイルをプライベートのセキュリティで保護された Azure Storage の場所にアップロードするために必要なアクセス許可を提供します。 このアクセス キーは組織に固有のもので、PST ファイルを Microsoft クラウドにアップロードした後に、PST ファイルへの不正アクセスから保護するのに役立ちます。 PST ファイルをインポートするために、組織が別個の Azure サブスクリプションを持つ必要はありません。

2. **Azure Storage の場所に PST ファイルをアップロードする:** 次の手順は、azcopy.exe ツール (手順 1 でダウンロード) を使用して、組織が所在する場所と同じ地域の Microsoft データ センターに置かれている Azure Storage の場所に PST ファイルをアップロードして保存することです。 PST ファイルをアップロードするには、インポートするファイルが組織のファイル共有またはファイル サーバー上にある必要があります。

    Azure Storage の場所にアップロードした後に PST ファイルのリストを表示するときに実行できるオプションの手順があることに注意してください。

3. **PST インポート マッピング ファイルを作成する:** PST ファイルを Azure Storage の場所にアップロードしたら、次は PST ファイルのインポート先となるユーザーのメールボックスを指定する、コンマ区切り値 (CSV) ファイルを作成します (PST ファイルはユーザーのプライマリ メールボックスまたはアーカイブ メールボックスにインポートすることができます)。Microsoft 365 インポート サービスは、CSV ファイルの情報を使用して PST ファイルをインポートします。

4. **PST インポート ジョブを作成する:** 次の手順では、セキュリティ/コンプライアンス センターの [**PST のインポート**] ページで PST インポート ジョブを作成し、前の手順で作成した PST インポート マッピング ファイルを送信します。 インポート ジョブを作成すると、Microsoft 365 によって PST ファイル内のデータが分析されます。その後、実際に PST インポート マッピング ファイルで指定したメールボックスにインポートするデータを制御するフィルターを設定できます。

5. **メールボックスにインポートされる PST データをフィルター処理する**: インポート ジョブを作成すると、Microsoft 365 は PST ファイルに含まれているアイテムの経過時間とさまざまなメッセージの種類を識別することで、PST ファイル内のデータを (安全に) 分析します。 分析が完了し、データをインポートする準備ができたら、PST ファイルに含まれるすべてのデータをインポートするか、インポートするデータをトリミングするかを選ぶことができます。データをトリミングする場合は、インポートするデータを制御するフィルターを設定します。

6. **PST インポート ジョブを開始する:** インポートジョブを開始すると、Microsoft 365 は PST インポートマッピングファイルの情報を使用して、PST ファイルを Azure Storage の場所からユーザーのメールボックスにインポートします。 インポート ジョブの進捗情報 (インポート中の各 PST ファイルに関する情報を含む) がコンプライアンス ポータルの [**PST のインポート**] ページに表示されます。 インポート ジョブが完了すると、ジョブの状態が [**完了**] に設定されます。
