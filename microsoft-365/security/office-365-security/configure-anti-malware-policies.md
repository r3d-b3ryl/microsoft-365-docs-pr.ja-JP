---
title: マルウェア対策ポリシーを構成する
f1.keywords:
- NOCSH
ms.author: chrisda
author: chrisda
manager: dansimp
ms.date: ''
audience: ITPro
ms.topic: how-to
ms.localizationpriority: medium
search.appverid:
- MET150
ms.assetid: b0cfc21f-e3c6-41b6-8670-feb2b2e252e5
ms.collection:
- M365-security-compliance
- m365initiative-defender-office365
description: 管理者が、Exchange Online Protection (EOP) でマルウェア対策ポリシーを表示、作成、変更、削除する方法を説明します。
ms.custom:
- seo-marvel-apr2020
ms.technology: mdo
ms.prod: m365-security
ms.openlocfilehash: 742e32188b3b8baaad3615d8f1a90b5f09fb2dbb
ms.sourcegitcommit: d1b60ed9a11f5e6e35fbaf30ecaeb9dfd6dd197d
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/29/2022
ms.locfileid: "66492295"
---
# <a name="configure-anti-malware-policies-in-eop"></a>EOP のマルウェア対策ポリシーを構成する

[!INCLUDE [MDO Trial banner](../includes/mdo-trial-banner.md)]

**適用対象**
- [Exchange Online Protection](exchange-online-protection-overview.md)
- [Microsoft Defender for Office 365 プラン 1 およびプラン 2](defender-for-office-365.md)
- [Microsoft 365 Defender](../defender/microsoft-365-defender.md)

Exchange Online のメールボックスを使用している Microsoft 365 の組織、または Exchange Online のメールボックスを使用していないものの、スタンドアロンの Exchange Online Protection (EOP) をお使いの組織の場合、メール メッセージは EOP によってマルウェアから自動的に保護されます。 EOP はマルウェア対策ポリシーを使用してマルウェア対策設定を行います。 詳細については、「[マルウェア対策保護](anti-malware-protection.md)」を参照してください。

管理者は、組織のニーズに合わせて既定のマルウェア対策ポリシーの表示、編集、構成を行うことができます (削除はできません)。より細かく設定できるように、カスタムのマルウェア対策保護ポリシーを作成し、組織内の指定したユーザー、グループ、またはドメインに適用することもできます。カスタム ポリシーは既定のポリシーより常に優先されますが、カスタム ポリシーの優先度 (実行順序) を変更できます。

マルウェア対策ポリシーの構成は、Microsoft 365 Defender ポータルで、または PowerShell (Exchange Online にメールボックスを持つ Microsoft 365 の組織向け Exchange Online PowerShell、Exchange Online メールボックスを持たない組織向けのスタンドアロン EOP PowerShell) で行います。

## <a name="what-do-you-need-to-know-before-you-begin"></a>はじめに把握しておくべき情報

- <https://security.microsoft.com> で Microsoft 365 Defender ポータルを開きます。 **[マルウェア対策ポリシー]** ページに直接移動するには、<https://security.microsoft.com/antimalwarev2> を使用します。

- Exchange Online PowerShell へ接続するには、「[Exchange Online PowerShell に接続する](/powershell/exchange/connect-to-exchange-online-powershell)」を参照してください。 スタンドアロンの EOP PowerShell に接続するには、「[Exchange Online Protection PowerShell への接続](/powershell/exchange/connect-to-exchange-online-protection-powershell)」を参照してください。

- この記事の手順を実行する際には、あらかじめ **Exchange Online** でアクセス許可を割り当てる必要があります。
  - マルウェア対策ポリシーを追加、変更、削除するには、**組織管理** または **セキュリティ管理者** 役割グループのメンバーである必要があります。
  - マルウェア対策ポリシーに読み取り専用でアクセスするには、**グローバル閲覧者** あるいは **セキュリティ閲覧者** 役割グループのメンバーである必要があります。

  詳細については、「[Exchange Online のアクセス許可](/exchange/permissions-exo/permissions-exo)」を参照してください。

  **注**:

  - Microsoft 365 管理センターで、対応する Azure Active Directory のロールにユーザーを追加すると、ユーザーには、必要なアクセス許可 _および_ Microsoft 365 のその他の機能に必要なアクセス許可が付与されます。詳しくは、「[管理者のロールについて](../../admin/add-users/about-admin-roles.md)」を参照してください。
  - [Exchange Online](/Exchange/permissions-exo/permissions-exo#role-groups) の **閲覧専用の組織管理** の役割グループが この機能への読み取り専用アクセス権も付与します。

- マルウェア対策ポリシーに推奨される設定については、「[EOP マルウェア対策ポリシー設定](recommended-settings-for-eop-and-office365.md#eop-anti-malware-policy-settings)」を参照してください。

## <a name="use-the-microsoft-365-defender-portal-to-create-anti-malware-policies"></a>Microsoft 365 Defender ポータルを使用して、マルウェア対策ポリシーを作成する

Microsoft 365 Defender ポータルでカスタムのマルウェア対策ポリシーを作成すると、マルウェア フィルター ルールと関連するマルウェア フィルター ポリシーが同時に作成され、両方に同じ名前が使われます。

1. <https://security.microsoft.com> の Microsoft 365 Defender ポータルで、**[ポリシー]** セクションの **[メールと共同作業]** \> **[ポリシーとルール]** \> **[脅威ポリシー]** \> **[マルウェア対策]** の順に移動します。**[マルウェア対策]** ページに直接移動するには、<https://security.microsoft.com/antimalwarev2> を使用します。

2. **[マルウェア対策]** ページで、![[作成] アイコン](../../media/m365-cc-sc-create-icon.png) **[作成]** をクリックします。

3. ポリシー ウィザードが開きます。**[ポリシーの名前を設定する]** ページで、次の設定を構成します。
   - **[名前]**: わかりやすい一意のポリシー名を入力します。
   - **[説明]**: ポリシーについての説明を入力します (オプション)。

   完了したら、**[次へ]** をクリックします。

4. [ **ユーザーとドメイン]** ページで、ポリシーが適用される内部受信者 (受信者の条件) を特定します。
   - **ユーザー**: 指定されたメールボックス、メール ユーザー、またはメール連絡先。
   - **グループ**: 
     - 指定された配布グループまたはメールが有効なセキュリティ グループのメンバー。
     - 指定した Microsoft 365 グループ。
   - **ドメイン**: 組織内で指定された [承認済みドメイン](/exchange/mail-flow-best-practices/manage-accepted-domains/manage-accepted-domains)のすべての受信者。

   適正なボックスをクリックし、値の入力を開始し、結果で希望する値を選択します。 必要な回数だけこの処理を繰り返します。 既存の値を削除するには、削除をクリックします ![[削除] アイコン](../../media/m365-cc-sc-remove-selection-icon.png) 値の隣。

   ユーザーやグループには、ほとんどの識別子 (名前、表示名、エイリアス、メールアドレス、アカウント名など) を使用できますが、対応する表示名が結果に表示されます。ユーザーの場合、アスタリスク (\*) を単独で入力すると、使用可能なすべての値が表示されます。

   同じ条件の複数の値は、OR ロジックを使用します (たとえば _\<recipient1\>_ または _\<recipient2\>_)。異なる条件では AND ロジックを使用します (たとえば _\<recipient1\>_ および _\<member of group 1\>_)。

   - **これらのユーザー、グループ、およびドメインを除外する**: ポリシーが適用される内部の受信者に関する例外 (受信者の例外) を追加するには、このオプションを選択して例外を構成します。設定と動作は、条件とまったく同じです。

   > [!IMPORTANT]
   > 複数の異なる条件または例外は可算的ではありません。包括的です。 ポリシーは、指定された _すべての_ 受信者フィルターに一致する受信者 _にのみ_ 適用されます。 たとえば、次の値を使用してポリシーで受信者フィルター条件を構成します:
   >
   > - 受信者は次のとおりです: romain@contoso.com
   > - 受信者が次のメンバーの場合: Executive
   >
   > ポリシーは、Executive グループのメンバーである場合 _にのみ_、romain@contoso.com に適用されます。 グループのメンバーでない場合、ポリシーは適用されません。
   >
   > 同様に、同じ受信者フィルターをポリシーの例外として使用する場合、受信者が Executive グループのメンバーでもある場合 _にのみ_、ポリシーは romain@contoso.com に適用されません。 グループのメンバーでない場合でも、ポリシーは適用されます。

   完了したら、**[次へ]** をクリックします。

5. **[保護の設定]** ページで、以下の設定を構成します。

   - **共通添付ファイル フィルターを有効にする**: このオプションを選択すると、指定された添付ファイルを含むメッセージはマルウェアとして扱われ、自動的に検疫されます。 [ **ファイルの種類のカスタマイズ** ] をクリックし、一覧の値を選択または選択解除することで、リストを変更できます。

     既定値と使用可能な値については、「 [マルウェア対策ポリシー](anti-malware-protection.md#anti-malware-policies)」を参照してください。

     **これらの型が見つかった場合**: 次のいずれかの値を選択します。

     - **配信不能レポート (NDR) を含むメッセージを拒否する (** 既定値)
     - **メッセージを検疫する**

   - **マルウェアのゼロアワー自動消去を有効にする**: このオプションを選択すると、既に配信されたマルウェア メッセージが ZAP によって検疫されます。 詳細については、「[Exchange Online のゼロアワー自動消去 (ZAP)](zero-hour-auto-purge.md)」を参照してください。

   - **検疫ポリシー**: マルウェアとして検疫されたメッセージに適用される検疫ポリシーを選択します。 検疫ポリシーは、検疫されたメッセージに対してユーザーが実行できる操作と、ユーザーが検疫通知を受け取るかどうかを定義します。 詳細については、「[検疫ポリシー](quarantine-policies.md)」を参照してください。

     空白の値は、既定の検疫ポリシーが使用されることを意味します (マルウェア検出には AdminOnlyAccessPolicy が使用されます)。 マルウェア対策ポリシーを後で編集するか、設定を表示すると、既定の検疫ポリシー名が表示されます。 サポートされている保護フィルターの判定に使用される既定の検疫ポリシーの詳細については、[この表](quarantine-policies.md#step-2-assign-a-quarantine-policy-to-supported-features)を参照してください。

     > [!NOTE]
     > 検疫ポリシーは、受信者がマルウェアとして検疫されたメッセージの電子メール通知を受信するかどうかを決定します。 検疫通知は AdminOnlyAccessPolicy で無効になっているため、通知が有効になっているカスタム検疫ポリシーを作成して割り当てる必要があります。 詳細については、「[検疫ポリシー](quarantine-policies.md)」を参照してください。
     >
     > ユーザーは、マルウェアとして検疫された独自のメッセージをリリースできません。 管理者は、検疫されたマルウェア メッセージのリリースをユーザーが要求できるように、検疫ポリシーを構成できます。

   - **管理通知**: 次のオプションのいずれも、いずれか一方、または両方を選択します。

       - **内部送信者からの未配信メッセージについて管理者に通知** する: このオプションを選択した場合は、表示される **[管理電子メール アドレス] ボックスに受信者の電子メール アドレス** を入力します。

       - **外部送信者からの未配信メッセージについて管理者に通知** する: このオプションを選択した場合は、表示される **[管理電子メール アドレス] ボックスに受信者の電子メール アドレス** を入力します。

     > [!NOTE]
     > 管理者の通知は、マルウェアとして分類された _添付ファイル_ についてのみ送信されます。

   - **通知をカスタマイズ** する: このセクションの設定を使用して、管理者通知に使用されるメッセージ プロパティをカスタマイズします。

       - **カスタマイズされた通知テキストを使用** する: このオプションを選択した場合は、[ **差出人名** ] ボックスと [差出人 **のアドレス** ] ボックスを使用して、管理者通知メッセージの送信者の名前と電子メール アドレスを指定します。

       - **内部送信者からのメッセージの通知をカスタマイズする**: 以前に [ **内部送信者からの未配信メッセージについて管理者に通知する**] を選択した場合は、[ **件名]** ボックスと **[メッセージ** ] ボックスを使用して、管理者通知メッセージの件名とメッセージ本文を指定します。

       - **外部送信者からのメッセージの通知をカスタマイズする**: 以前に [ **外部送信者からの未配信メッセージについて管理者に通知** する] を選択した場合は、[ **件名]** ボックスと **[メッセージ** ] ボックスを使用して、管理者通知メッセージの件名とメッセージ本文を指定する必要があります。

   完了したら、**[次へ]** をクリックします。

6. [ **校閲** ] ページで、設定を確認します。 各セクションで **[編集]** を選択して、そのセクション内の設定を変更することができます。 または、**[戻る]** をクリックするか、ウィザードで特定のページを選択します。

   完了したら、**[送信]** をクリックします。

7. 表示された [確認]ページで、**[完了]** をクリックします。

## <a name="use-the-microsoft-365-defender-portal-to-view-anti-malware-policies"></a>Microsoft 365 Defender ポータルを使用して、マルウェア対策ポリシーを表示する

1. <https://security.microsoft.com> の Microsoft 365 Defender ポータルで、**[ポリシー]** セクションの **[メールと共同作業]** \> **[ポリシーとルール]** \> **[脅威ポリシー]** \> **[マルウェア対策]** の順に移動します。**[マルウェア対策]** ページに直接移動するには、<https://security.microsoft.com/antimalwarev2> を使用します。

2. **[マルウェア対策]** ページでは、マルウェア対策ポリシーの一覧に以下のプロパティが表示されます。
   - **名前**
   - **状態**
   - **優先度**

3. ポリシーの名前をクリックして選択すると、ポリシー設定がポップアウトで表示されます。

## <a name="use-the-microsoft-365-defender-portal-to-modify-anti-malware-policies"></a>Microsoft 365 Defender ポータルを使用して、マルウェア対策ポリシーを変更する

1. <https://security.microsoft.com> の Microsoft 365 Defender ポータルで、**[ポリシー]** セクションの **[メールと共同作業]** \> **[ポリシーとルール]** \> **[脅威ポリシー]** \> **[マルウェア対策]** の順に移動します。**[マルウェア対策]** ページに直接移動するには、<https://security.microsoft.com/antimalwarev2> を使用します。

2. **[マルウェア対策ポリシー]** ページで、リストからポリシーの名前をクリックして選択します。

3. 表示されるポリシーの詳細ポップアップで、各セクションで **[編集]** を選択して、そのセクション内の設定を変更することができます。 設定の詳細については、この以前の記事の「[Microsoft 365 Defender ポータルを使用してマルウェア対策ポリシーを作成する](#use-the-microsoft-365-defender-portal-to-create-anti-malware-policies)」セクションを参照してください。

   既定のマルウェア対策ポリシーの場合、**[ユーザー、グループ、およびドメイン]** セクションは選択できず (ポリシーは全員に適用される)、ポリシーの名前を変更することもできません。

ポリシーを有効または無効にするか、ポリシーの優先順位を設定するには、次のセクションをご覧ください。

### <a name="enable-or-disable-custom-anti-malware-policies"></a>カスタム マルウェア対策ポリシーを有効または無効にする

既定のマルウェア対策ポリシーを無効にすることはできません。

1. <https://security.microsoft.com> の Microsoft 365 Defender ポータルで、**[ポリシー]** セクションの **[メールと共同作業]** \> **[ポリシーとルール]** \> **[脅威ポリシー]** \> **[マルウェア対策]** の順に移動します。**[マルウェア対策]** ページに直接移動するには、<https://security.microsoft.com/antimalwarev2> を使用します。

2. **[マルウェア対策ポリシー]** ページで、リストからカスタム ポリシーの名前をクリックして選択します。

3. 表示されるポリシーの詳細ポップアップの上部には、以下のいずれかの値が表示されます。
   - **ポリシー オフ**: ポリシーをオンにするには、![[アイコンをオンにする]](../../media/m365-cc-sc-turn-on-off-icon.png)、**[オンにする]** の順にクリックします。
   - **ポリシー オン**: ポリシーをオフにするには、![[アイコンをオフにする]](../../media/m365-cc-sc-turn-on-off-icon.png)、**[オフにする]** の順にクリックします。

4. 確認ダイアログ ボックスが表示されたら、**[オンにする]** または **[オフにする]** をクリックします。

5. ポリシーの詳細ポップアップで **[閉じる]** をクリックします。

ポリシーのメイン ページに戻ると、ポリシーの **[状態]** の値が **[オン]** または **[オフ]** になります。

### <a name="set-the-priority-of-custom-anti-malware-policies"></a>カスタム マルウェア対策ポリシーの優先度を設定する

既定では、マルウェア対策ポリシーには、ポリシーの作成順序に基づいた優先度が指定されます (新しいポリシーの優先度が古いポリシーよりも低くなります)。優先度番号が小さいほど、ポリシーの優先度が高くなることを意味し (0 が最高)、ポリシーは優先度順に処理されます (優先度の高いポリシーは、優先度の低いポリシーよりも前に処理されます)。2 つのポリシーに同じ優先度を設定することはできず、ポリシー処理は最初のポリシーが適用されると停止します。

ポリシーの優先度を変更するには、ポリシーのプロパティで [**優先度を上げる**] または [**優先度を下げる**] をクリックします (Microsoft 365 Defender ポータルの [**優先度**] の数値を直接変更することはできません)。ポリシーの優先度を変更することは、複数のポリシーを所有している場合にのみ意味があります。

 **注意**:

- Microsoft 365 Defender ポータルでは、マルウェア対策ポリシーの優先度は、そのポリシーの作成後にのみ変更できます。PowerShell では、マルウェア フィルター ルールの作成時に既定の優先度を上書きできます (既存のルールの優先度に影響を与える可能性があります)。
- マルウェア対策ポリシーは、表示される順に処理されます (最初のポリシーの値は **優先度** が 0)。 既定のマルウェア対策ポリシーの優先度の値は **最低** で、変更することはできません。

1. <https://security.microsoft.com> の Microsoft 365 Defender ポータルで、**[ポリシー]** セクションの **[メールと共同作業]** \> **[ポリシーとルール]** \> **[脅威ポリシー]** \> **[マルウェア対策]** の順に移動します。**[マルウェア対策]** ページに直接移動するには、<https://security.microsoft.com/antimalwarev2> を使用します。

2. **[マルウェア対策ポリシー]** ページで、リストからカスタム ポリシーの名前をクリックして選択します。

3. 表示されるポリシーの詳細ポップアップの上部には、現在の優先度の値とカスタム ポリシーの数に基づいて、**[優先度を上げる]** または **[優先度を下げる]** が表示されます。
   - **優先度** の値が **0** のポリシーでは、**[優先度を下げる]** オプションのみ利用可能です。
   - **優先度** 値が最低のポリシー (例: **3**) では、**[優先度を下げる]** オプションのみ利用可能です。
   - 3 つ以上のポリシーがある場合、優先度の値が最も高いポリシーと最も低いポリシーの間では、**[優先度を上げる]** と **[優先度を下げる]** の両方のオプションが利用可能です。

   ![[優先度を上げる] アイコン](../../media/m365-cc-sc-increase-icon.png)、**[優先度を上げる]** の順にクリックするか、または ![[優先度を下げる] アイコン](../../media/m365-cc-sc-decrease-icon.png)、**[優先度を下げる]** の順にクリックして、**優先度** 値を変更します。

4. 完了したら、ポリシーの詳細ポップアップで **[閉じる]** をクリックします。

## <a name="use-the-microsoft-365-defender-portal-to-remove-custom-anti-malware-policies"></a>Microsoft 365 Defender ポータルを使用して、カスタムのマルウェア対策ポリシーを削除する

Microsoft 365 Defender ポータルを使用して、カスタムマルウェア対策ポリシーを削除すると、マルウェア フィルター ルールと、それに対応するマルウェア フィルター ポリシーが両方とも削除されます。既定のマルウェア対策ポリシーを削除することはできません。

1. <https://security.microsoft.com> の Microsoft 365 Defender ポータルで、**[ポリシー]** セクションの **[メールと共同作業]** \> **[ポリシーとルール]** \> **[脅威ポリシー]** \> **[マルウェア対策]** の順に移動します。**[マルウェア対策]** ページに直接移動するには、<https://security.microsoft.com/antimalwarev2> を使用します。

2. **[マルウェア対策] ページ** で、リストからカスタム ポリシーの名前をクリックして選択します。

3. 表示されるポリシーの詳細ポップアウトの上部で、![[その他の操作] アイコン](../../media/m365-cc-sc-more-actions-icon.png)、**[その他の操作]** \> ![[ポリシーの削除] アイコン](../../media/m365-cc-sc-delete-icon.png) **[ポリシーの削除]** の順にクリックします。

4. 確認ダイアログ ボックスが表示されたら、**[はい]** をクリックします。

## <a name="use-exchange-online-powershell-or-standalone-eop-powershell-to-configure-anti-malware-policies"></a>Exchange Online PowerShell または スタンドアロン EOP PowerShell を使用してマルウェア対策ポリシーを構成する

PowerShell のスパム対策ポリシーの詳細については、「[Microsoft 365 Defender ポータルと PowerShell のマルウェア対策ポリシー](anti-malware-protection.md#anti-malware-policies-in-the-microsoft-365-defender-portal-vs-powershell)」を参照してください。

### <a name="use-powershell-to-create-anti-malware-policies"></a>PowerShell を使用してマルウェア対策ポリシーを作成する

PowerShell では、2 段階の手順でマルウェア対策ポリシーを作成します。

1. マルウェア フィルター ポリシーを作成する。
2. マルウェア フィルター ルールを作成する (ルールの適用先のマルウェア フィルター ポリシーを指定します)。

 **注意**:

- 新しいマルウェア フィルター ルールを作成して、それに既存の関連付けされていないマルウェア フィルター ポリシーを割り当てることができます。 1 つのマルウェア フィルター ルールを複数のマルウェア フィルター ポリシーに関連付けることはできません。
- PowerShell で新しいマルウェア ポリシーに対して構成できる設定のうち、Microsoft 365 Defender ポータルではルールを作成するまで利用できないものが 2 つあります。
  - 新しいポリシーを無効化された状態で作成する (**New-MalwareFilterRule** コマンドレットで _Enabled_ `$false` を指定)。
  - 作成時にポリシーの優先度を設定する (**New-MalwareFilterRule** コマンドレットで _Priority_ _\<Number\>_ を指定)。
- ポリシーをマルウェア フィルター ルールに割り当てるまでは、PowerShell で作成した新しいマルウェア フィルター ポリシーを Microsoft 365 Defender ポータルに表示することはできません。

#### <a name="step-1-use-powershell-to-create-a-malware-filter-policy"></a>手順 1: PowerShell を使用してマルウェア フィルター ポリシーを構成する

マルウェア フィルター ポリシーを作成するには、次の構文を使用します。

```PowerShell
New-MalwareFilterPolicy -Name "<PolicyName>" [-AdminDisplayName "<OptionalComments>"] [-CustomNotifications <$true | $false>] [<Inbound notification options>] [<Outbound notification options>] [-QuarantineTag <QuarantineTagName>]
```

この例では、次に示す設定で Contoso Malware Filter Policy という新しいマルウェア フィルター ポリシーを作成します。

- 内部送信者からのメッセージでマルウェアが検出されたときに admin@contoso.com に通知します。
- マルウェア検出のための既定の [検疫ポリシー](quarantine-policies.md)が使用されます ( _QuarantineTag_ パラメーターは使用していません)。

```PowerShell
New-MalwareFilterPolicy -Name "Contoso Malware Filter Policy" -EnableInternalSenderAdminNotifications $true -InternalSenderAdminAddress admin@contoso.com
```

構文とパラメーターの詳細については、「[New-MalwareFilterPolicy](/powershell/module/exchange/new-malwarefilterpolicy)」を参照してください。

#### <a name="step-2-use-powershell-to-create-a-malware-filter-rule"></a>手順 2: PowerShell を使用してマルウェア フィルター ポリシーを作成する

マルウェア フィルター ルールを作成するには、次の構文を使用します。

```PowerShell
New-MalwareFilterRule -Name "<RuleName>" -MalwareFilterPolicy "<PolicyName>" <Recipient filters> [<Recipient filter exceptions>] [-Comments "<OptionalComments>"]
```

この例では、次に示す設定で Contoso Recipients という新しいマルウェア フィルター ルールを作成します。

- Contoso Malware Filter Policy というマルウェア フィルター ポリシーにルールを割り当てる。
- contoso.com ドメイン内の受信者にルールを適用する。

```PowerShell
New-MalwareFilterRule -Name "Contoso Recipients" -MalwareFilterPolicy "Contoso Malware Filter Policy" -RecipientDomainIs contoso.com
```

構文とパラメーターの詳細については、「[New-MalwareFilterRule](/powershell/module/exchange/new-malwarefilterrule)」を参照してください。

### <a name="use-powershell-to-view-malware-filter-policies"></a>PowerShell を使用してマルウェア フィルター ポリシーを表示する

すべてのマルウェア フィルター ポリシーの要約リストを返すには、次のコマンドを実行します。

```PowerShell
Get-MalwareFilterPolicy
```

特定のマルウェア フィルター ポリシーに関する詳細情報を返すには、次の構文を使用します。

```PowerShell
Get-MalwareFilterPolicy -Identity "<PolicyName>" | Format-List [<Specific properties to view>]
```

この例では、Executives というマルウェア フィルター ポリシーにルールのすべてのプロパティの値を戻します。

```PowerShell
Get-MalwareFilterPolicy -Identity "Executives" | Format-List
```

この例では、同じポリシーの指定したプロパティのみを戻します。

```PowerShell
Get-MalwareFilterPolicy -Identity "Executives" | Format-List Action,AdminDisplayName,CustomNotifications,Enable*Notifications
```

構文とパラメーターの詳細については、「[Get-MalwareFilterPolicy](/powershell/module/exchange/get-malwarefilterpolicy)」を参照してください。

### <a name="use-powershell-to-view-malware-filter-rules"></a>PowerShell を使用してマルウェア フィルター ルールを表示する

すべてのマルウェア フィルター ルールの要約リストを返すには、次のコマンドを実行します。

```PowerShell
Get-MalwareFilterRule
```

ルールを有効または無効にしてリストをフィルター処理するには、次のコマンドを実行します。

```PowerShell
Get-MalwareFilterRule -State Disabled
```

```PowerShell
Get-MalwareFilterRule -State Enabled
```

特定のマルウェア フィルター ルールの詳細情報を返すには、次の構文を使用します。

```PowerShell
Get-MalwareFilterRule -Identity "<RuleName>" | Format-List [<Specific properties to view>]
```

この例では、Executives というマルウェア フィルター ルールのすべてのプロパティの値を返します。

```PowerShell
Get-MalwareFilterRule -Identity "Executives" | Format-List
```

この例では、同じルールの指定されたプロパティのみを返します。

```PowerShell
Get-MalwareFilterRule -Identity "Executives" | Format-List Name,Priority,State,MalwareFilterPolicy,*Is,*SentTo,*MemberOf
```

構文とパラメーターの詳細については、「[Get-MalwareFilterRule](/powershell/module/exchange/get-malwarefilterrule)」を参照してください。

### <a name="use-powershell-to-modify-malware-filter-policies"></a>PowerShell を使用してマルウェア フィルター ポリシーを変更する

この記事の「[手順 1: PowerShell を使用してスパム フィルター ポリシーを作成する](#step-1-use-powershell-to-create-a-malware-filter-policy)」セクションで前述したとおり、以下の項目に加えて、ポリシーを作成したときと同じ設定を PowerShell を使ってマルウェア フィルター ポリシーを変更するときに使用できます。

- 特定のポリシーを既定のポリシー (全員に適用され、変更できない **最低** の優先度を持ち、削除することはできない) に切り替える _MakeDefault_ スイッチは、PowerShell でマルウェア フィルター ポリシーを変更するときにのみ使用できます。
- マルウェア フィルター ポリシーの名前を変更することはできません (**Set-MalwareFilterPolicy** コマンドレットには _Name_ パラメーターがありません)。 Microsoft 365 Defender ポータルでマルウェア対策ポリシーの名前を変更する場合は、マルウェア フィルター _ルール_ の名前を変更するだけになります。

マルウェア フィルター ポリシー

```PowerShell
Set-MalwareFilterPolicy -Identity "<PolicyName>" <Settings>
```

構文とパラメーターの詳細については、「[Set-MalwareFilterPolicy](/powershell/module/exchange/set-malwarefilterpolicy)」を参照してください。

> [!NOTE]
> マルウェア対策フィルター ポリシーで使用する[検疫ポリシー](quarantine-policies.md)を指定する詳細な手順については、「[PowerShell を使用して、マルウェア対策ポリシーで検疫ポリシーを指定する](quarantine-policies.md#anti-malware-policies-in-powershell)」を参照してください。

### <a name="use-powershell-to-modify-malware-filter-rules"></a>PowerShell を使用してマルウェア フィルター ルールを変更する

PowerShell でマルウェア フィルター ルールを変更するときに使用できない唯一の設定は、無効なルールの作成を可能にする _Enabled_ パラメーターです。

それ以外は、PowerShell でマルウェア フィルター ルールを変更する際に利用可能な追加の設定はありません。 この記事で前述の「[手順 2: PowerShell を使用してマルウェア フィルター ルールを作成する](#step-2-use-powershell-to-create-a-malware-filter-rule)」セクションでルールを作成したときと同じ設定を使用できます。

マルウェア フィルター ルールを変更するには、次の構文を使用します。

```PowerShell
Set-MalwareFilterRule -Identity "<RuleName>" <Settings>
```

構文とパラメーターの詳細については、「[Set-MalwareFilterRule](/powershell/module/exchange/set-malwarefilterrule)」を参照してください。

### <a name="use-powershell-to-enable-or-disable-malware-filter-rules"></a>PowerShell を使ってマルウェア フィルター ルールを有効または無効にする

PowerShell でマルウェア フィルター ルールを有効または無効にすると、すべてのマルウェア対策ポリシー (マルウェア フィルター ルールおよび割り当てられているマルウェア フィルター ポリシー) が有効または無効になります。 既定のマルウェア対策ポリシーを有効または無効にできません (すべての受信者に常に適用されます)。

PowerShell でマルウェア フィルター ルールを有効または無効にするには、次の構文を使用します。

```PowerShell
<Enable-MalwareFilterRule | Disable-MalwareFilterRule> -Identity "<RuleName>"
```

この例では、Marketing Department というマルウェア フィルター ルールを無効化します。

```PowerShell
Disable-MalwareFilterRule -Identity "Marketing Department"
```

この例では、同じルールを有効化します。

```PowerShell
Enable-MalwareFilterRule -Identity "Marketing Department"
```

詳細な構文およびパラメーターの情報については、[Enable-MalwareFilterRule](/powershell/module/exchange/enable-malwarefilterrule) と [Disable-MalwareFilterRule](/powershell/module/exchange/disable-malwarefilterrule).を参照してください。

### <a name="use-powershell-to-set-the-priority-of-malware-filter-rules"></a>PowerShell を使用してマルウェア フィルター ルールの優先度を設定する

ルールに設定できる優先度の最高値値は 0 です。設定できる最低値はルールの数に依存します。たとえば、ルールが五つある場合、使用できる優先度の値は 0 から 4 です。既存の一つのルールの優先度を変更すると、他のルールにも連鎖的な影響が起こりえます。たとえば、カスタム ルールが五つある場合 (優先度 0 から 4) に、一つのルールの優先度を 2 に変更した場合、既存の優先度 2 のルールは優先度 3 に変更され、優先度 3 は優先度 4 に変更されます。

PowerShell でマルウェア フィルター ルールの優先度を設定するには、次の構文を使用します。

```PowerShell
Set-MalwareFilterRule -Identity "<RuleName>" -Priority <Number>
```

この例では、Marketing Department というルールの優先度を 2 に設定しています。優先度が 2 以下のすべての既存のルールは、優先度が 1 ずつ下がります (優先度番号が 1 ずつ増加します)。

```PowerShell
Set-MalwareFilterRule -Identity "Marketing Department" -Priority 2
```

**注**:

- 新しく作成したルールの優先度を設定するには、**New-MalwareFilterRule** コマンドレットの _Priority_ パラメーターを使用します。
- 既定のマルウェア フィルター ポリシーには、対応するマルウェア フィルター ルールがありません。また、常に、**最低** の優先度が設定されており、変更はできません。

### <a name="use-powershell-to-remove-malware-filter-policies"></a>PowerShell を使用してマルウェア フィルター ポリシーを削除する

PowerShell を使用してマルウェア フィルター ポリシーを削除したときには、それに対応するマルウェア フィルター ルールは削除されません。

PowerShell でマルウェア フィルター ポリシーを削除するには、次の構文を使用します。

```PowerShell
Remove-MalwareFilterPolicy -Identity "<PolicyName>"
```

この例では、Marketing Department というマルウェア フィルター ポリシーを削除します。

```PowerShell
Remove-MalwareFilterPolicy -Identity "Marketing Department"
```

構文とパラメーターの詳細については、「[Remove-MalwareFilterPolicy](/powershell/module/exchange/remove-malwarefilterpolicy)」を参照してください。

### <a name="use-powershell-to-remove-malware-filter-rules"></a>PowerShell を使用してマルウェア フィルター ルールを削除する

PowerShell を使用してマルウェア フィルター ルールを削除したときには、それに対応するマルウェア フィルター ポリシーは削除されません。

PowerShell でマルウェア フィルター ルールを削除するには、次の構文を使用します。

```PowerShell
Remove-MalwareFilterRule -Identity "<PolicyName>"
```

この例では、Marketing Department というマルウェア フィルター ルールを削除します。

```PowerShell
Remove-MalwareFilterRule -Identity "Marketing Department"
```

構文とパラメーターの詳細については、「[Remove-MalwareFilterRule](/powershell/module/exchange/remove-malwarefilterrule)」を参照してください。

## <a name="how-do-you-know-these-procedures-worked"></a>正常な動作を確認する方法

### <a name="use-the-eicartxt-file-to-verify-your-anti-malware-policy-settings"></a>EICAR.TXT ファイルを使用してマルウェア対策ポリシー設定を確認する

> [!IMPORTANT]
> EICAR.TXT ファイルはウイルスではありません。このファイルは、ウイルス対策のインストールと設定を安全にテストするために European Institute for Computer Antivirus Research (EICAR) によって開発されました。

1. メモ帳を開き、次のテキストを空白のファイルに貼り付けます。

   ```Text
   X5O!P%@AP[4\PZX54(P^)7CC)7}$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H*
   ```

   これらがファイル内の唯一のテキスト文字であることを確認してください。 ファイル サイズは 68 バイトです。

2. ファイルを EICAR.TXT として保存する

   デスクトップのウイルス対策プログラムで、EICAR.TXT をスキャンの対象から必ず除外してください (そうしないと、ファイルは検疫されます)。

3. EICAR.TXT ファイルを添付ファイルとして含むメールを送信します。このとき、ファイルを自動的にブロックしないメール クライアントを使用し、送信スパムを自動的にブロックしないメール サービスを使用します。マルウェア対策ポリシー設定を使用して、テストする次のシナリオを決定します。
   - 内部メールボックスから内部受信者にメールを送信します。
   - 内部メールボックスから外部受信者にメールを送信します。
   - 外部メールボックスから内部受信者にメールを送信します。

4. メッセージが検疫されたことを確認し、マルウェア対策ポリシー設定に基づいて管理者通知の結果を確認します。 たとえば、指定した管理者の電子メール アドレスは、既定またはカスタマイズされた通知メッセージを使用して、内部または外部のメッセージ送信者に対して通知されます。

5. テストが完了したら、EICAR.TXT ファイルを削除します (これにより、他のユーザーに対して不要な警告が実行されないようにします)。
